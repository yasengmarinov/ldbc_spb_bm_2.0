PREFIX inst: <http://www.ontotext.com/connectors/mongodb/instance#>
PREFIX : <http://www.ontotext.com/connectors/mongodb#>
PREFIX cwork: <http://www.bbc.co.uk/ontologies/creativework/>
PREFIX dbpedia: <http://dbpedia.org/resource/>
PREFIX ldbcspb: <http://www.ldbcouncil.org/spb#>
PREFIX bbc: <http://www.bbc.co.uk/ontologies/bbc/>
PREFIX geo-ont: <http://www.geonames.org/ontology#>
select DISTINCT ?entity ?title ?dateModified  where{
    {
select (group_concat(?creativeWork; separator = '", "') as ?ids) where{
            select distinct ?creativeWork where
{
  {{{geonamesFeatureURI}}} geo-ont:parentFeature ?province .
  ?province geo-ont:featureCode geo-ont:A.ADM1 .
  {
    ?location geo-ont:parentFeature ?province .
  } UNION {
    BIND(?province as ?location) .
  }
    ?creativeWork cwork:tag ?location

                }
}
        }
         values ?template {
        '''{"@graph.0.@id" : {$in :["$arg1"]}, "@graph.cwork:dateModified.@date": {
                                               "$gt": ISODate('{{{cwStartDateTime}}}'),
                                               "$lt": ISODate('{{{cwEndDateTime}}}')
                                               } }'''
        }
        bind (replace(str(?template), "\\$arg1", str(?ids)) as ?mongoQuery )

    {
       ?search a inst:spb100 ;
                       :find ?mongoQuery ;
                       :entity ?entity .
               graph inst:spb100 {
                   ?entity a ?type .
                   ?entity cwork:title ?title .
                   ?entity cwork:dateModified ?dateModified .
               }
        }

    }
